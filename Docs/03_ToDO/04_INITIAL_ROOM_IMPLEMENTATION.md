# ìµœì´ˆë°© êµ¬í˜„ ê°€ì´ë“œ
**ì‘ì„±ì¼**: 2025-10-28
**ëª©ì **: ì˜¨ë³´ë”© ì™„ë£Œ í›„ ìë™ ìƒì„±ë˜ëŠ” ë£¸ë©”ì´íŠ¸ ë°© êµ¬í˜„

---

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ìê°€ ì˜¨ë³´ë”©ì„ ì™„ë£Œí•˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ëœ ë£¸ë©”ì´íŠ¸ì™€ ê·¸ì˜ ë°©ì´ ë©”ì¸ í™”ë©´ì— í‘œì‹œë©ë‹ˆë‹¤. ì´ ë¬¸ì„œëŠ” ìµœì´ˆë°© ìƒì„± ë° ë Œë”ë§ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

---

## ğŸ”„ ì „ì²´ í”Œë¡œìš°

```
[ì˜¨ë³´ë”© ì™„ë£Œ]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ     â”‚
â”‚ - ë„ë©”ì¸, í‚¤ì›Œë“œ, ê´€ì‹¬ì‚¬            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ìë™ ìºë¦­í„° ìƒì„±            â”‚
â”‚ - ìš•êµ¬ ë²¡í„° ë¶„ì„                    â”‚
â”‚ - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±              â”‚
â”‚ - ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ë£¸ë©”ì´íŠ¸ ë°© ì´ë¯¸ì§€ ìƒì„±     â”‚
â”‚ - AI ì´ë¯¸ì§€ ìƒì„± (Gemini Imagen)    â”‚
â”‚ - ë˜ëŠ” Fallback í”„ë¦¬ì…‹ ì‚¬ìš©         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: DB ì €ì¥                     â”‚
â”‚ - personas í…Œì´ë¸”                   â”‚
â”‚ - rooms í…Œì´ë¸”                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: ì²« ì¸ì‚¬ë§ ìƒì„±              â”‚
â”‚ - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ í™˜ì˜ ë©”ì‹œì§€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: ë©”ì¸ í™”ë©´ ë Œë”ë§            â”‚
â”‚ - ë£¸ë©”ì´íŠ¸ ë°© ì¤‘ì•™ (0, 0) í‘œì‹œ      â”‚
â”‚ - ì²« ì¸ì‚¬ë§ íŒì—…                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 1: ì˜¨ë³´ë”© ë°ì´í„° ìˆ˜ì§‘

### ì˜¨ë³´ë”© í”Œë¡œìš° (4ë‹¨ê³„)

```typescript
// ê¸°ì¡´ ì˜¨ë³´ë”© ì‹œìŠ¤í…œê³¼ í†µí•©

interface OnboardingData {
  userId: string;

  // Step 1: Extensionì—ì„œ ìë™ ìˆ˜ì§‘
  browsing: {
    domains: string[];        // ë°©ë¬¸ ë„ë©”ì¸
    keywords: string[];       // ê²€ìƒ‰ í‚¤ì›Œë“œ
    categories: string[];     // ìë™ ë¶„ë¥˜ëœ ì¹´í…Œê³ ë¦¬
  };

  // Step 2: ìˆ˜ë™ ì…ë ¥ (ì„ íƒ)
  manual: {
    interests: string[];      // ê´€ì‹¬ì‚¬
    avoidTopics: string[];    // ê¸ˆê¸° ì£¼ì œ
  };

  // Step 3: ì„ í˜¸ë„ ì„¤ì • (ì„ íƒ)
  preferences: {
    conversationStyle: 'casual' | 'formal' | 'mixed';
    responseLength: 'short' | 'medium' | 'long';
  };

  // Step 4: ì™„ë£Œ
  completed: boolean;
  completedAt: Date;
}
```

### ì™„ë£Œ íŠ¸ë¦¬ê±°

```typescript
// frontend/src/app/onboarding/complete/page.tsx

'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useOnboardingStore } from '@/stores/useOnboardingStore';

export default function OnboardingCompletePage() {
  const router = useRouter();
  const { data, markComplete } = useOnboardingStore();

  useEffect(() => {
    const completeOnboarding = async () => {
      try {
        // 1. ì˜¨ë³´ë”© ë°ì´í„° ì„œë²„ ì „ì†¡
        const response = await fetch('/api/v1/onboarding/complete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          // 2. ë¡œì»¬ ìƒíƒœ ì™„ë£Œ í‘œì‹œ
          markComplete();

          // 3. ìƒì„±ëœ ë£¸ë©”ì´íŠ¸ ì •ë³´ í‘œì‹œ í›„ ë©”ì¸ìœ¼ë¡œ
          setTimeout(() => {
            router.push('/');
          }, 3000);
        }

      } catch (error) {
        console.error('Onboarding completion failed:', error);
      }
    };

    completeOnboarding();
  }, []);

  return (
    <div className="flex flex-col items-center justify-center min-h-screen">
      <div className="pixel-card max-w-md p-8">
        <h1 className="pixel-text text-2xl mb-4">
          ë‹¹ì‹ ì˜ ë£¸ë©”ì´íŠ¸ë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”...
        </h1>
        <div className="loading-spinner" />
        <p className="pixel-text text-sm mt-4 text-gray-600">
          ê³§ ë§Œë‚  ìˆ˜ ìˆì–´ìš”!
        </p>
      </div>
    </div>
  );
}
```

---

## Step 2: ìë™ ìºë¦­í„° ìƒì„±

### Backend API ì—”ë“œí¬ì¸íŠ¸

```typescript
// backend/src/routes/onboarding.ts

import express from 'express';
import { autoGenerateRoommate } from '../services/roommateService';

const router = express.Router();

router.post('/complete', async (req, res) => {
  const { userId, browsing, manual, preferences } = req.body;

  try {
    // 1. ì˜¨ë³´ë”© ë°ì´í„° ì €ì¥
    await saveOnboardingData(userId, { browsing, manual, preferences });

    // 2. ìë™ ìºë¦­í„° ìƒì„±
    const roommate = await autoGenerateRoommate(userId, {
      domains: browsing.domains,
      keywords: browsing.keywords,
      interests: manual.interests,
      avoidTopics: manual.avoidTopics
    });

    // 3. ì²« ì¸ì‚¬ë§ ìƒì„±
    const firstMessage = await generateFirstMessage(roommate.systemPrompt);

    return res.json({
      success: true,
      roommate: {
        id: roommate.id,
        name: roommate.name,
        keywords: roommate.keywords,
        firstMessage
      }
    });

  } catch (error) {
    console.error('Onboarding completion error:', error);
    return res.status(500).json({
      success: false,
      error: 'ONBOARDING_FAILED',
      message: error.message
    });
  }
});

export default router;
```

### ìë™ ìƒì„± ì„œë¹„ìŠ¤

```typescript
// backend/src/services/roommateService.ts

import { PrismaClient } from '@prisma/client';
import {
  extractPresenceVector,
  buildCompleteVector,
  detectParadoxes,
  designComplementaryRoommate,
  assembleSystemPrompt
} from './characterGenerator';
import { generateRoomImage } from './imageGenerator';

const prisma = new PrismaClient();

interface AutoGenerateParams {
  domains: string[];
  keywords: string[];
  interests: string[];
  avoidTopics: string[];
}

export async function autoGenerateRoommate(
  userId: string,
  data: AutoGenerateParams
) {

  // 1. ì¤‘ë³µ í™•ì¸
  const existing = await prisma.personas.findFirst({
    where: { userId, personaType: 'roommate' }
  });

  if (existing) {
    throw new Error('ROOMMATE_ALREADY_EXISTS');
  }

  // 2. ìš•êµ¬ ë²¡í„° ë¶„ì„
  const presenceVector = await extractPresenceVector(data);
  const completeVector = buildCompleteVector(presenceVector, []);
  const paradoxes = detectParadoxes(completeVector);
  const complementaryStrategy = designComplementaryRoommate(completeVector);

  // 3. ìºë¦­í„° ì´ë¦„ ìƒì„± (ê°„ë‹¨í•œ ê·œì¹™ ê¸°ë°˜)
  const name = generateKoreanName();

  // 4. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì¡°ë¦½
  const systemPrompt = assembleSystemPrompt(
    name,
    completeVector,
    paradoxes,
    complementaryStrategy
  );

  // 5. ì´ë¯¸ì§€ ìƒì„± (ë¹„ë™ê¸°)
  let imageUrl = '';
  try {
    const imageResult = await generateRoomImage(completeVector);
    imageUrl = imageResult.url;
  } catch (error) {
    console.error('Image generation failed, using fallback:', error);
    imageUrl = selectFallbackPreset(completeVector);
  }

  // 6. DB ì €ì¥
  const roommate = await prisma.personas.create({
    data: {
      userId,
      personaType: 'roommate',
      name,
      systemPrompt,
      basePrompt: systemPrompt,
      personalityTraits: extractPersonalityTraits(systemPrompt),
      interests: data.interests,
      conversationStyle: inferConversationStyle(completeVector),
      keywords: generateKeywords(completeVector),
      focusTopics: data.interests,
      avoidTopics: data.avoidTopics,

      // ë¶„ì„ ê²°ê³¼ë„ ì €ì¥ (JSONB)
      analysisData: {
        presenceVector,
        completeVector,
        paradoxes,
        complementaryStrategy
      }
    }
  });

  // 7. ë°© ìƒì„±
  const room = await prisma.rooms.create({
    data: {
      userId,
      personaId: roommate.id,
      imageUrl,
      positionX: 0,  // ì¤‘ì•™
      positionY: 0,
      isUnlocked: true
    }
  });

  return {
    id: roommate.id,
    name,
    systemPrompt,
    keywords: roommate.keywords,
    imageUrl,
    roomId: room.id
  };
}

function generateKoreanName(): string {
  const surnames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤'];
  const names = ['ë¯¼ìˆ˜', 'ì„œì¤€', 'í•˜ì¤€', 'ë„ìœ¤', 'ì‹œìš°', 'ì£¼ì›', 'ì§€í›„', 'ì¤€ì„œ'];

  const surname = surnames[Math.floor(Math.random() * surnames.length)];
  const name = names[Math.floor(Math.random() * names.length)];

  return `${surname}${name}`;
}
```

---

## Step 3: ì²« ì¸ì‚¬ë§ ìƒì„±

### LLM ê¸°ë°˜ í™˜ì˜ ë©”ì‹œì§€

```typescript
// backend/src/services/messageService.ts

import { callGeminiAPI } from './geminiService';

export async function generateFirstMessage(
  systemPrompt: string
): Promise<string> {

  const prompt = `
You are a roommate character with the following personality:

${systemPrompt}

The user just moved into the building and you are meeting them for the first time.
Generate a warm, natural first greeting message.

[Requirements]
- 2-3 sentences in Korean
- Friendly and welcoming tone
- Include one small detail that reflects your personality/interests
- End with a light question to start conversation
- Stay in character

[Example (DO NOT copy, create original)]
"ì–´, ë“œë””ì–´ ì™”êµ¬ë‚˜! ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆì–´. ë‚˜ ë°©ê¸ˆ ìƒˆë¡œìš´ ê²Œì„ ë°œê²¬í–ˆëŠ”ë°, ë„ˆë„ ê²Œì„ ì¢‹ì•„í•´?"

[Output]
Only return the greeting message, no explanation.
`.trim();

  try {
    const result = await callGeminiAPI(prompt, {
      temperature: 0.8,  // ë” creative
      maxTokens: 150
    });

    return result.trim();

  } catch (error) {
    console.error('Failed to generate first message:', error);

    // Fallback ê¸°ë³¸ ì¸ì‚¬
    return 'ì•ˆë…•! ë“œë””ì–´ ë§Œë‚¬ë„¤. ì˜ ë¶€íƒí•´!';
  }
}
```

---

## Step 4: ë©”ì¸ í™”ë©´ ë Œë”ë§

### ë°© ëª©ë¡ ì¡°íšŒ API

```typescript
// backend/src/routes/room.ts

router.get('/my-rooms', authMiddleware, async (req, res) => {
  const userId = req.userId;

  const rooms = await prisma.rooms.findMany({
    where: { userId },
    include: {
      persona: {
        select: {
          id: true,
          name: true,
          personaType: true,
          keywords: true
        }
      }
    },
    orderBy: {
      createdAt: 'asc'  // ë£¸ë©”ì´íŠ¸ ë°©ì´ ì²« ë²ˆì§¸
    }
  });

  return res.json({
    success: true,
    rooms: rooms.map(room => ({
      id: room.id,
      position: { x: room.positionX, y: room.positionY },
      imageUrl: room.imageUrl,
      isUnlocked: room.isUnlocked,
      persona: room.persona
    }))
  });
});
```

### Frontend ë©”ì¸ í™”ë©´

```typescript
// frontend/src/app/page.tsx

'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import RoomGrid from '@/components/RoomGrid';
import FirstMessageModal from '@/components/FirstMessageModal';

interface Room {
  id: string;
  position: { x: number; y: number };
  imageUrl: string;
  isUnlocked: boolean;
  persona: {
    id: string;
    name: string;
    personaType: string;
    keywords: string[];
  };
}

export default function MainPage() {
  const router = useRouter();
  const [rooms, setRooms] = useState<Room[]>([]);
  const [firstMessage, setFirstMessage] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadRooms();
  }, []);

  const loadRooms = async () => {
    try {
      const res = await fetch('/api/v1/rooms/my-rooms', {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      const data = await res.json();

      if (data.success) {
        setRooms(data.rooms);

        // ë£¸ë©”ì´íŠ¸ ë°©ì´ ì²˜ìŒ ìƒì„±ë˜ì—ˆìœ¼ë©´ ì²« ì¸ì‚¬ë§ í‘œì‹œ
        const roommateRoom = data.rooms.find(
          r => r.persona.personaType === 'roommate'
        );

        if (roommateRoom && isNewUser()) {
          // ì²« ì¸ì‚¬ë§ ê°€ì ¸ì˜¤ê¸°
          const msg = await fetchFirstMessage(roommateRoom.persona.id);
          setFirstMessage(msg);
        }
      }

    } catch (error) {
      console.error('Failed to load rooms:', error);
    } finally {
      setLoading(false);
    }
  };

  const fetchFirstMessage = async (personaId: string): Promise<string> => {
    try {
      const res = await fetch(`/api/v1/chat/first-message/${personaId}`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      const data = await res.json();
      return data.message || 'ì•ˆë…•! ì˜ ë¶€íƒí•´!';

    } catch (error) {
      return 'ì•ˆë…•! ë§Œë‚˜ì„œ ë°˜ê°€ì›Œ!';
    }
  };

  const isNewUser = (): boolean => {
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì²´í¬ (ê°„ë‹¨í•œ ë°©ë²•)
    const hasSeenWelcome = localStorage.getItem('hasSeenWelcome');
    if (!hasSeenWelcome) {
      localStorage.setItem('hasSeenWelcome', 'true');
      return true;
    }
    return false;
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="loading-spinner" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-900 text-white">
      {/* ë©”ì¸ ë¹Œë”© ë·° */}
      <RoomGrid rooms={rooms} />

      {/* ì²« ì¸ì‚¬ë§ ëª¨ë‹¬ */}
      {firstMessage && (
        <FirstMessageModal
          message={firstMessage}
          roommateName={rooms.find(r => r.persona.personaType === 'roommate')?.persona.name || 'ë£¸ë©”ì´íŠ¸'}
          onClose={() => setFirstMessage(null)}
        />
      )}
    </div>
  );
}
```

### ë°© ê·¸ë¦¬ë“œ ì»´í¬ë„ŒíŠ¸

```typescript
// frontend/src/components/RoomGrid.tsx

'use client';

import Image from 'next/image';

interface Room {
  id: string;
  position: { x: number; y: number };
  imageUrl: string;
  isUnlocked: boolean;
  persona: {
    id: string;
    name: string;
    keywords: string[];
  };
}

interface RoomGridProps {
  rooms: Room[];
}

export default function RoomGrid({ rooms }: RoomGridProps) {
  const handleRoomClick = (room: Room) => {
    if (!room.isUnlocked) {
      // ì ê¸´ ë°© í´ë¦­ ì‹œ ë…¸í¬ ì‹œìŠ¤í…œ
      alert('ì´ ë°©ì€ ì•„ì§ ì ê²¨ ìˆì–´ìš”. ë…¸í¬ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!');
      return;
    }

    // ëŒ€í™” ì‹œì‘
    window.location.href = `/chat/${room.persona.id}`;
  };

  // ì¤‘ì•™ ì¢Œí‘œ ê³„ì‚° (ë£¸ë©”ì´íŠ¸ ë°© ê¸°ì¤€)
  const roommateRoom = rooms.find(r => r.persona.personaType === 'roommate');
  const centerX = roommateRoom?.position.x || 0;
  const centerY = roommateRoom?.position.y || 0;

  return (
    <div className="relative w-full h-screen overflow-auto">
      <div className="absolute inset-0 flex items-center justify-center">
        <div className="relative" style={{ width: '800px', height: '600px' }}>
          {rooms.map(room => {
            const offsetX = (room.position.x - centerX) * 280;
            const offsetY = (room.position.y - centerY) * 280;

            return (
              <div
                key={room.id}
                className="absolute cursor-pointer transition-transform hover:scale-105"
                style={{
                  left: `${400 + offsetX}px`,
                  top: `${300 + offsetY}px`,
                  width: '256px',
                  height: '512px'
                }}
                onClick={() => handleRoomClick(room)}
              >
                {/* ë°© ì´ë¯¸ì§€ */}
                <div className="relative w-full h-full border-4 border-yellow-400 rounded-lg overflow-hidden">
                  <Image
                    src={room.imageUrl}
                    alt={`${room.persona.name}'s room`}
                    fill
                    className="object-cover pixel-art"
                  />

                  {/* ì ê¸ˆ ì˜¤ë²„ë ˆì´ */}
                  {!room.isUnlocked && (
                    <div className="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center">
                      <div className="text-6xl">ğŸ”’</div>
                    </div>
                  )}
                </div>

                {/* ë°© ì •ë³´ */}
                <div className="mt-2 text-center">
                  <div className="pixel-text text-lg font-bold">
                    {room.persona.name}
                  </div>
                  <div className="flex justify-center gap-1 mt-1 flex-wrap">
                    {room.persona.keywords.slice(0, 3).map(keyword => (
                      <span
                        key={keyword}
                        className="pixel-text text-xs px-2 py-1 bg-blue-600 rounded"
                      >
                        #{keyword}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}
```

### ì²« ì¸ì‚¬ë§ ëª¨ë‹¬

```typescript
// frontend/src/components/FirstMessageModal.tsx

'use client';

interface FirstMessageModalProps {
  message: string;
  roommateName: string;
  onClose: () => void;
}

export default function FirstMessageModal({
  message,
  roommateName,
  onClose
}: FirstMessageModalProps) {

  return (
    <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
      <div className="pixel-card max-w-md p-8 animate-fade-in">
        <h2 className="pixel-text text-2xl mb-4 text-yellow-400">
          {roommateName}ë‹˜ì´ ì¸ì‚¬ë¥¼ ê±´ë„¸ì–´ìš”!
        </h2>

        <div className="pixel-speech-bubble p-4 mb-6">
          <p className="pixel-text text-lg">
            {message}
          </p>
        </div>

        <button
          onClick={onClose}
          className="pixel-button w-full"
        >
          ëŒ€í™” ì‹œì‘í•˜ê¸°
        </button>
      </div>
    </div>
  );
}
```

---

## ğŸ¨ í”½ì…€ì•„íŠ¸ ìŠ¤íƒ€ì¼ CSS

### ê¸€ë¡œë²Œ ìŠ¤íƒ€ì¼

```css
/* frontend/src/app/globals.css */

/* í”½ì…€ì•„íŠ¸ ì´ë¯¸ì§€ ë Œë”ë§ */
.pixel-art {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* ë§í’ì„  */
.pixel-speech-bubble {
  position: relative;
  background: #2d3748;
  border: 4px solid #4a5568;
  border-radius: 8px;
}

.pixel-speech-bubble::before {
  content: '';
  position: absolute;
  bottom: -20px;
  left: 20px;
  width: 0;
  height: 0;
  border-left: 20px solid transparent;
  border-right: 0 solid transparent;
  border-top: 20px solid #4a5568;
}

/* í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out;
}

/* í”½ì…€ ë²„íŠ¼ */
.pixel-button {
  font-family: 'Press Start 2P', cursive;
  font-size: 14px;
  padding: 12px 24px;
  background: #ecc94b;
  border: 4px solid #000;
  color: #000;
  cursor: pointer;
  transition: transform 0.1s;
}

.pixel-button:hover {
  transform: scale(1.05);
}

.pixel-button:active {
  transform: scale(0.95);
}

/* í”½ì…€ ì¹´ë“œ */
.pixel-card {
  background: #1a202c;
  border: 4px solid #2d3748;
  border-radius: 8px;
  box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.5);
}

/* í”½ì…€ í…ìŠ¤íŠ¸ */
.pixel-text {
  font-family: 'Press Start 2P', cursive;
  line-height: 1.6;
}
```

---

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜

```env
# backend/.env

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/knock

# Gemini API
GEMINI_API_KEY=your_gemini_api_key_here

# Image Storage
CDN_BASE_URL=https://cdn.knock.com
CDN_UPLOAD_PATH=/rooms

# Feature Flags
AUTO_GENERATE_ROOMMATE=true
USE_AI_IMAGE_GENERATION=true  # falseë©´ í•­ìƒ í”„ë¦¬ì…‹ ì‚¬ìš©
```

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ì´ë¯¸ì§€ ë¡œë”©

```typescript
// í”„ë¦¬ë¡œë”©ìœ¼ë¡œ ì²« í™”ë©´ ë¹ ë¥´ê²Œ í‘œì‹œ

const preloadImages = async (imageUrls: string[]) => {
  const promises = imageUrls.map(url => {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = resolve;
      img.onerror = reject;
      img.src = url;
    });
  });

  await Promise.all(promises);
};
```

### ë°±ê·¸ë¼ìš´ë“œ ìƒì„±

```typescript
// ì´ë¯¸ì§€ ìƒì„±ì´ ì˜¤ë˜ ê±¸ë¦¬ë©´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬

router.post('/complete', async (req, res) => {
  const { userId, browsing, manual, preferences } = req.body;

  // ì¦‰ì‹œ ì‘ë‹µ (í”„ë¦¬ì…‹ ì´ë¯¸ì§€ ì‚¬ìš©)
  const roommate = await autoGenerateRoommate(userId, {
    ...data,
    usePreset: true  // ì¼ë‹¨ í”„ë¦¬ì…‹ìœ¼ë¡œ
  });

  res.json({
    success: true,
    roommate: {
      id: roommate.id,
      firstMessage: await generateFirstMessage(roommate.systemPrompt)
    }
  });

  // ë°±ê·¸ë¼ìš´ë“œì—ì„œ AI ì´ë¯¸ì§€ ìƒì„±
  generateRoomImageBackground(roommate.id, roommate.completeVector)
    .then(imageUrl => {
      // ìƒì„± ì™„ë£Œ í›„ ì—…ë°ì´íŠ¸
      updateRoommateImage(roommate.id, imageUrl);

      // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ (WebSocket ë˜ëŠ” ë‹¤ìŒ ì ‘ì† ì‹œ)
      notifyImageReady(userId, roommate.id);
    })
    .catch(error => {
      console.error('Background image generation failed:', error);
      // í”„ë¦¬ì…‹ ê·¸ëŒ€ë¡œ ìœ ì§€
    });
});
```

---

## âœ… í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì •ìƒ í”Œë¡œìš°
```
1. ì˜¨ë³´ë”© ì™„ë£Œ
2. ìë™ ìºë¦­í„° ìƒì„± (5ì´ˆ ì´ë‚´)
3. ì´ë¯¸ì§€ ìƒì„± (10ì´ˆ ì´ë‚´ ë˜ëŠ” Fallback)
4. DB ì €ì¥ í™•ì¸
5. ë©”ì¸ í™”ë©´ ë Œë”ë§
6. ì²« ì¸ì‚¬ë§ ëª¨ë‹¬ í‘œì‹œ
7. ëŒ€í™” ì‹œì‘
```

### 2. ì˜ˆì™¸ ì²˜ë¦¬
```
- ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨ â†’ í”„ë¦¬ì…‹ ì‚¬ìš©
- ì²« ì¸ì‚¬ë§ ìƒì„± ì‹¤íŒ¨ â†’ ê¸°ë³¸ ë©”ì‹œì§€
- ì¤‘ë³µ ë£¸ë©”ì´íŠ¸ ìƒì„± ì‹œë„ â†’ ê¸°ì¡´ ë£¸ë©”ì´íŠ¸ ë°˜í™˜
```

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```
- 100ëª… ë™ì‹œ ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬
- ì´ë¯¸ì§€ ìƒì„± ë³‘ëª© í™•ì¸ (queue ì‹œìŠ¤í…œ í•„ìš”ì„±)
- ë©”ì¸ í™”ë©´ ë¡œë”© ì†ë„ (2ì´ˆ ì´ë‚´ ëª©í‘œ)
```

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. âœ… ì´ ë¬¸ì„œ ì™„ì„±
2. â†’ [05_API_SPECIFICATIONS.md](./05_API_SPECIFICATIONS.md) ì°¸ì¡°
3. ì˜¨ë³´ë”© ì™„ë£Œ API êµ¬í˜„
4. ìë™ ìºë¦­í„° ìƒì„± ì„œë¹„ìŠ¤ êµ¬í˜„
5. ë©”ì¸ í™”ë©´ UI êµ¬í˜„
6. ì²« ì¸ì‚¬ë§ ì‹œìŠ¤í…œ êµ¬í˜„

---

**ì°¸ì¡° ë¬¸ì„œ**:
- [feature-spec.md](../01_Feature/02_Roommate/feature-spec.md)
- [tech-spec.md](../01_Feature/02_Roommate/tech-spec.md)
- [02_CHARACTER_GENERATOR_FLOW.md](./02_CHARACTER_GENERATOR_FLOW.md)
- [03_IMAGE_GENERATION_SYSTEM.md](./03_IMAGE_GENERATION_SYSTEM.md)
