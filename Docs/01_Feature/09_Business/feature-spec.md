# ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ - ê¸°ëŠ¥ ëª…ì„¸ì„œ

## 1. í”Œëœ êµ¬ì¡°

### 1.1 ë¬´ë£Œ í”Œëœ (Free)

#### 1.1.1 ì œê³µ ê¸°ëŠ¥
| ê¸°ëŠ¥ | ì œí•œ ì‚¬í•­ |
|------|-----------|
| ì´ì›ƒ ë…¸í¬ | 1ì¼ 1íšŒ (ë§¤ì¼ 00ì‹œ UTC ì´ˆê¸°í™”) |
| LLM ëª¨ë¸ | Gemini 1.5 Flash (ê¸°ë³¸) |
| ëŒ€í™” ë©”ëª¨ë¦¬ | ìµœê·¼ 5ê°œ ëŒ€í™” ìš”ì•½ ì €ì¥ |
| ê´€ê³„ ì‹œìŠ¤í…œ | ìë™ ê´€ê³„ ë³€í™” (ìˆ˜ë™ ìˆ˜ì • ë¶ˆê°€) |
| ë°© ì´ë¯¸ì§€ | í”„ë¦¬ì…‹ í…œí”Œë¦¿ (5ì¢…) |
| ìµœëŒ€ ì´ì›ƒ ìˆ˜ | ë¬´ì œí•œ (ë…¸í¬ ì†ë„ ì œí•œë§Œ ì ìš©) |

#### 1.1.2 ì œí•œ í‘œì‹œ
**ë…¸í¬ ì œí•œ ë„ë‹¬ ì‹œ**:
- ë…¸í¬ ë²„íŠ¼ ë¹„í™œì„±í™”
- íˆ´íŒ: "ì˜¤ëŠ˜ì˜ ë¬´ë£Œ ë…¸í¬ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆì–´ìš”. ë‚´ì¼ 00ì‹œì— ë‹¤ì‹œ ë…¸í¬í•  ìˆ˜ ìˆì–´ìš”."
- CTA: "Knock Plusë¡œ ì§€ê¸ˆ ë°”ë¡œ ë…¸í¬í•˜ê¸°" ë²„íŠ¼ (ì—…ê·¸ë ˆì´ë“œ ìœ ë„)

**ë©”ëª¨ë¦¬ ì œí•œ**:
- 6ë²ˆì§¸ ëŒ€í™”ë¶€í„° ê°€ì¥ ì˜¤ë˜ëœ ë©”ëª¨ë¦¬ ìë™ ì‚­ì œ (FIFO)
- ì„¤ì • í™”ë©´ì— "5/5 ë©”ëª¨ë¦¬ ì‚¬ìš© ì¤‘" í‘œì‹œ

---

### 1.2 ìœ ë£Œ í”Œëœ (Knock Plus)

#### 1.2.1 ê°€ê²© ì •ì±…
| í”Œëœ | ê°€ê²© (USD) | ê°€ê²© (KRW) | í• ì¸ìœ¨ |
|------|-----------|-----------|--------|
| Knock Plus Monthly | $9.99/ì›” | â‚©12,900/ì›” | - |
| Knock Plus Yearly | $95.88/ë…„ | â‚©129,000/ë…„ | 20% |

**ê°€ê²© ì „ëµ ê·¼ê±°**:
- ê²½ìŸì‚¬ ë¶„ì„: ChatGPT Plus ($20), Claude Pro ($20), Character.AI Plus ($9.99)
- íƒ€ê²Ÿ: ìºì£¼ì–¼ ì‚¬ìš©ì + AI ëŒ€í™” ì• í˜¸ê°€
- í¬ì§€ì…”ë‹: í”„ë¦¬ë¯¸ì—„ ê²½í—˜, ì €ë ´í•œ ê°€ê²©

#### 1.2.2 ì œê³µ ê¸°ëŠ¥

**1. í›… ê°€ì† (Knock Acceleration)**
- **ì¦‰ì‹œ ë…¸í¬**: 1ì¼ 1íšŒ ì œí•œ í•´ì œ
  - ë¬´ì œí•œ ë…¸í¬ (ê³µì • ì‚¬ìš© ì •ì±…: 1ì¼ ìµœëŒ€ 10íšŒ ê¶Œì¥)
  - ì¿¨ë‹¤ìš´ ì—†ìŒ
- **ì¶”ê°€ ì´ìš©ê¶Œ**: ë…¸í¬ ì´ìš©ê¶Œ ì†Œë¹„ ì—†ì´ ì¦‰ì‹œ ì‹¤í–‰
- **ìš°ì„  ìƒì„±**: ì´ì›ƒ ìƒì„± ì‹œ LLM ìš°ì„  ì²˜ë¦¬ (ëŒ€ê¸° ì‹œê°„ ë‹¨ì¶•)

**2. ë”¥ ë‹¤ì´ë¸Œ ëŒ€í™” (Deep Dive)**
- **ê¸´ ë©”ëª¨ë¦¬**: ìµœê·¼ 50ê°œ ëŒ€í™” ìš”ì•½ ì €ì¥ (10ë°° ì¦ê°€)
- **ê³ ê¸‰ LLM**: Gemini 1.5 Pro ëª¨ë¸ ì‚¬ìš©
  - ë” í’ë¶€í•œ ì‘ë‹µ
  - ë³µì¡í•œ ë§¥ë½ ì´í•´
  - ì¥ë¬¸ ëŒ€í™” ì§€ì› (ìµœëŒ€ 4000 í† í°)
- **ê¹Šì€ ëŒ€í™” ëª¨ë“œ**: í™œì„±í™” ì‹œ ì‘ë‹µ ê¸¸ì´ 2ë°° (4-8ë¬¸ì¥)

**3. ê´€ê³„ ê´€ë¦¬ (Relationship Control)**
- **í”„ë¡¬í”„íŠ¸ í¸ì§‘**: ì´ì›ƒì˜ ê´€ì‹¬ì‚¬ í‚¤ì›Œë“œ 3ê°œ ì¶”ê°€/ì‚­ì œ
  - ì˜ˆ: "ê²Œì„" í‚¤ì›Œë“œ ì¶”ê°€ â†’ ê²Œì„ ê´€ë ¨ ëŒ€í™” ì¦ê°€
- **ë§íˆ¬ ì¡°ì •**: 3ê°€ì§€ í”„ë¦¬ì…‹ ì„ íƒ
  - ì¹œê·¼í•œ ë°˜ë§
  - ì •ì¤‘í•œ ì¡´ëŒ“ë§
  - ìºì£¼ì–¼ í˜¼ìš© (ê¸°ë³¸)
- **ê´€ê³„ ì´ˆê¸°í™”**: íŠ¹ì • ì´ì›ƒê³¼ì˜ ê´€ê³„ ë ˆë²¨ ë¦¬ì…‹ (ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘)

**4. í”„ë¦¬ë¯¸ì—„ ë¹„ì£¼ì–¼**
- **AI ìƒì„± ë°© ì´ë¯¸ì§€**: Stable Diffusion ê¸°ë°˜ ê°œì¸í™” ì´ë¯¸ì§€
- **ì´ë¯¸ì§€ ì¬ìƒì„±**: ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ë©´ 1íšŒ ì¬ìƒì„± ê°€ëŠ¥

#### 1.2.3 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
```sql
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID UNIQUE REFERENCES users(id) ON DELETE CASCADE,

  -- í”Œëœ ì •ë³´
  plan_type VARCHAR(50) NOT NULL, -- 'free', 'plus_monthly', 'plus_yearly'
  status VARCHAR(50) NOT NULL, -- 'active', 'canceled', 'past_due', 'expired'

  -- ê²°ì œ ì •ë³´
  stripe_customer_id VARCHAR(255),
  stripe_subscription_id VARCHAR(255),
  payment_method VARCHAR(50), -- 'stripe', 'toss'

  -- êµ¬ë… ê¸°ê°„
  current_period_start TIMESTAMP,
  current_period_end TIMESTAMP,
  trial_end TIMESTAMP, -- ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼ (ì„ íƒ)

  -- ìƒíƒœ ê´€ë¦¬
  canceled_at TIMESTAMP,
  cancel_at_period_end BOOLEAN DEFAULT FALSE,

  -- ë©”íƒ€ë°ì´í„°
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_status ON subscriptions(status);
CREATE INDEX idx_subscriptions_stripe_customer ON subscriptions(stripe_customer_id);
```

```sql
CREATE TABLE usage_quotas (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID UNIQUE REFERENCES users(id) ON DELETE CASCADE,

  -- ë…¸í¬ ì‚¬ìš©ëŸ‰
  daily_knocks_used INT DEFAULT 0,
  daily_knocks_limit INT DEFAULT 1,
  last_knock_reset TIMESTAMP DEFAULT NOW(),

  -- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
  memory_count INT DEFAULT 0,
  memory_limit INT DEFAULT 5,

  -- ê´€ê³„ ê´€ë¦¬ ì‚¬ìš©ëŸ‰ (ìœ ë£Œ ì „ìš©)
  relationship_edits_used INT DEFAULT 0,
  relationship_edits_limit INT DEFAULT 10, -- ì›” 10íšŒ ì œí•œ

  -- ë©”íƒ€ë°ì´í„°
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_usage_quotas_user_id ON usage_quotas(user_id);
```

---

## 2. êµ¬ë… ê´€ë¦¬

### 2.1 êµ¬ë… ì‹œì‘

#### 2.1.1 í”Œëœ ì„ íƒ í™”ë©´
**ìœ„ì¹˜**: ì„¤ì • > êµ¬ë… ê´€ë¦¬ ë˜ëŠ” ì œí•œ ë„ë‹¬ ì‹œ ëª¨ë‹¬

**í™”ë©´ êµ¬ì„±**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Knock Plusë¡œ ì—…ê·¸ë ˆì´ë“œ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  [ë¬´ë£Œ í”Œëœ]          [Knock Plus]     â”‚
â”‚  âœ“ 1ì¼ 1íšŒ ë…¸í¬       âœ“ ë¬´ì œí•œ ë…¸í¬    â”‚
â”‚  âœ“ ê¸°ë³¸ LLM          âœ“ ê³ ê¸‰ LLM Pro    â”‚
â”‚  âœ“ 5ê°œ ë©”ëª¨ë¦¬        âœ“ 50ê°œ ë©”ëª¨ë¦¬     â”‚
â”‚  âœ— ê´€ê³„ ê´€ë¦¬         âœ“ ê´€ê³„ ì»¤ìŠ¤í„°ë§ˆì´ì§•â”‚
â”‚                                        â”‚
â”‚  í˜„ì¬ í”Œëœ           $9.99/ì›”          â”‚
â”‚                     [êµ¬ë… ì‹œì‘í•˜ê¸°]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.1.2 ê²°ì œ í”„ë¡œì„¸ìŠ¤
**ë‹¨ê³„**:
1. í”Œëœ ì„ íƒ (ì›”ê°„/ì—°ê°„)
2. ê²°ì œ ìˆ˜ë‹¨ ì…ë ¥ (Stripe Checkout)
3. ê²°ì œ í™•ì¸
4. êµ¬ë… í™œì„±í™”
5. ì™„ë£Œ í™”ë©´ (í˜œíƒ ì•ˆë‚´)

**API ëª…ì„¸**:
```typescript
POST /api/v1/subscriptions/create
Headers:
{
  "Authorization": "Bearer {token}"
}

Request:
{
  "planType": "plus_monthly" | "plus_yearly",
  "paymentMethod": "stripe",
  "successUrl": "https://knock.com/subscription/success",
  "cancelUrl": "https://knock.com/subscription/cancel"
}

Response:
{
  "success": true,
  "checkoutUrl": "https://checkout.stripe.com/c/pay/cs_test_...",
  "sessionId": "cs_test_..."
}
```

### 2.2 êµ¬ë… í™œì„±í™” (Webhook ì²˜ë¦¬)

#### 2.2.1 Stripe Webhook ì´ë²¤íŠ¸
```typescript
POST /api/v1/webhooks/stripe
Headers:
{
  "stripe-signature": "..."
}

Body:
{
  "type": "checkout.session.completed",
  "data": {
    "object": {
      "id": "cs_test_...",
      "customer": "cus_...",
      "subscription": "sub_...",
      "metadata": {
        "userId": "550e8400-..."
      }
    }
  }
}
```

#### 2.2.2 êµ¬ë… í™œì„±í™” ë¡œì§
```typescript
async function handleSubscriptionActivated(
  userId: string,
  stripeCustomerId: string,
  stripeSubscriptionId: string,
  planType: string
) {
  // 1. êµ¬ë… ë ˆì½”ë“œ ìƒì„±/ì—…ë°ì´íŠ¸
  await prisma.subscription.upsert({
    where: { userId },
    create: {
      userId,
      planType,
      status: 'active',
      stripeCustomerId,
      stripeSubscriptionId,
      currentPeriodStart: new Date(),
      currentPeriodEnd: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30ì¼ í›„
    },
    update: {
      planType,
      status: 'active',
      stripeCustomerId,
      stripeSubscriptionId
    }
  });

  // 2. ì‚¬ìš©ëŸ‰ ì œí•œ ì—…ë°ì´íŠ¸
  await prisma.usageQuota.update({
    where: { userId },
    data: {
      dailyKnocksLimit: 999, // ë¬´ì œí•œ (ì‚¬ì‹¤ìƒ)
      memoryLimit: 50,
      relationshipEditsLimit: 10
    }
  });

  // 3. í™˜ì˜ ì•Œë¦¼
  await sendWelcomeNotification(userId);

  // 4. ë¶„ì„ ì´ë²¤íŠ¸
  await trackEvent('subscription_activated', userId, { planType });
}
```

### 2.3 êµ¬ë… ê°±ì‹ 

#### 2.3.1 ìë™ ê°±ì‹ 
- Stripeê°€ ìë™ìœ¼ë¡œ ê²°ì œ ì‹œë„
- ì„±ê³µ ì‹œ: `invoice.payment_succeeded` ì›¹í›… ìˆ˜ì‹ 
- ì‹¤íŒ¨ ì‹œ: `invoice.payment_failed` ì›¹í›… ìˆ˜ì‹ 

#### 2.3.2 ê°±ì‹  ì‹¤íŒ¨ ì²˜ë¦¬
```typescript
async function handlePaymentFailed(userId: string) {
  // 1. ìƒíƒœ ë³€ê²½
  await prisma.subscription.update({
    where: { userId },
    data: { status: 'past_due' }
  });

  // 2. ìœ ì˜ˆ ê¸°ê°„ ë¶€ì—¬ (7ì¼)
  const gracePeriodEnd = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);

  // 3. ì•Œë¦¼ ë°œì†¡
  await sendPaymentFailedEmail(userId, gracePeriodEnd);

  // 4. 7ì¼ í›„ì—ë„ ì‹¤íŒ¨ ì‹œ êµ¬ë… ë§Œë£Œ
  setTimeout(async () => {
    const sub = await getSubscription(userId);
    if (sub.status === 'past_due') {
      await expireSubscription(userId);
    }
  }, 7 * 24 * 60 * 60 * 1000);
}
```

### 2.4 êµ¬ë… ì·¨ì†Œ

#### 2.4.1 ì¦‰ì‹œ ì·¨ì†Œ vs ê¸°ê°„ ì¢…ë£Œ ì‹œ ì·¨ì†Œ
**ì˜µì…˜ ì œê³µ**:
- **ì¦‰ì‹œ ì·¨ì†Œ**: ë°”ë¡œ ë¬´ë£Œ í”Œëœìœ¼ë¡œ ì „í™˜, í™˜ë¶ˆ ì—†ìŒ (ì¼í•  ê³„ì‚° ì„ íƒ)
- **ê¸°ê°„ ì¢…ë£Œ ì‹œ ì·¨ì†Œ**: í˜„ì¬ êµ¬ë… ê¸°ê°„ê¹Œì§€ ì‚¬ìš© í›„ ìë™ ì¢…ë£Œ

**API ëª…ì„¸**:
```typescript
POST /api/v1/subscriptions/cancel
Headers:
{
  "Authorization": "Bearer {token}"
}

Request:
{
  "immediately": boolean,  // true: ì¦‰ì‹œ, false: ê¸°ê°„ ì¢…ë£Œ ì‹œ
  "reason": "too_expensive" | "not_using" | "other",
  "feedback": "string (optional)"
}

Response:
{
  "success": true,
  "message": "êµ¬ë…ì´ 2025-11-27ì— ì¢…ë£Œë©ë‹ˆë‹¤.",
  "effectiveDate": "2025-11-27T23:59:59Z"
}
```

#### 2.4.2 ì·¨ì†Œ ìœ ì§€ (Retention) ì „ëµ
**í™”ë©´ êµ¬ì„±**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ì •ë§ ë– ë‚˜ì‹œë‚˜ìš”? ğŸ˜¢              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  ì•„ì§ ì´ëŸ° ê¸°ëŠ¥ì´ ë‚¨ì•„ìˆì–´ìš”:          â”‚
â”‚  âœ“ ë¬´ì œí•œ ë…¸í¬ë¡œ ë” ë§ì€ ì´ì›ƒ ë°œê²¬     â”‚
â”‚  âœ“ 50ê°œ ë©”ëª¨ë¦¬ë¡œ ê¹Šì€ ëŒ€í™” ì´ì–´ê°€ê¸°    â”‚
â”‚                                        â”‚
â”‚  [íŠ¹ë³„ í• ì¸ ì œì•ˆ]                      â”‚
â”‚  ë‹¤ìŒ 3ê°œì›” 30% í• ì¸ ($6.99/ì›”)        â”‚
â”‚                                        â”‚
â”‚  [í• ì¸ ë°›ê³  ê³„ì†í•˜ê¸°]  [ì·¨ì†Œ ì§„í–‰]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ì‚¬ìš©ëŸ‰ ì¶”ì  ë° ì œí•œ

### 3.1 ë…¸í¬ ì‚¬ìš©ëŸ‰ ì¶”ì 

#### 3.1.1 ì¼ì¼ ë…¸í¬ ì¹´ìš´íŒ…
```typescript
async function checkKnockAvailability(userId: string): Promise<{
  available: boolean;
  remaining: number;
  resetAt: Date;
}> {
  const quota = await prisma.usageQuota.findUnique({ where: { userId } });
  const subscription = await prisma.subscription.findUnique({ where: { userId } });

  // ë¬´ë£Œ ì‚¬ìš©ì: 1ì¼ 1íšŒ ì œí•œ
  if (subscription.planType === 'free') {
    const now = new Date();
    const lastReset = new Date(quota.lastKnockReset);
    const nextReset = new Date(lastReset);
    nextReset.setUTCHours(0, 0, 0, 0);
    nextReset.setDate(nextReset.getDate() + 1);

    // ìì • ì§€ë‚¬ìœ¼ë©´ ë¦¬ì…‹
    if (now >= nextReset) {
      await prisma.usageQuota.update({
        where: { userId },
        data: {
          dailyKnocksUsed: 0,
          lastKnockReset: now
        }
      });
      return { available: true, remaining: 1, resetAt: nextReset };
    }

    const remaining = quota.dailyKnocksLimit - quota.dailyKnocksUsed;
    return {
      available: remaining > 0,
      remaining,
      resetAt: nextReset
    };
  }

  // ìœ ë£Œ ì‚¬ìš©ì: ë¬´ì œí•œ (ê³µì • ì‚¬ìš© ì •ì±… ì²´í¬)
  return { available: true, remaining: 999, resetAt: new Date() };
}

async function consumeKnock(userId: string): Promise<void> {
  await prisma.usageQuota.update({
    where: { userId },
    data: {
      dailyKnocksUsed: { increment: 1 }
    }
  });
}
```

### 3.2 ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¶”ì 

```typescript
async function checkMemoryAvailability(userId: string): Promise<boolean> {
  const quota = await prisma.usageQuota.findUnique({ where: { userId } });
  return quota.memoryCount < quota.memoryLimit;
}

async function addMemory(userId: string, memory: Memory): Promise<void> {
  const quota = await prisma.usageQuota.findUnique({ where: { userId } });

  // ì œí•œ ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ë©”ëª¨ë¦¬ ì‚­ì œ (FIFO)
  if (quota.memoryCount >= quota.memoryLimit) {
    const oldestMemory = await prisma.memory.findFirst({
      where: { userId },
      orderBy: { createdAt: 'asc' }
    });

    if (oldestMemory) {
      await prisma.memory.delete({ where: { id: oldestMemory.id } });
    }
  }

  // ìƒˆ ë©”ëª¨ë¦¬ ì¶”ê°€
  await prisma.memory.create({ data: memory });

  // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
  await prisma.usageQuota.update({
    where: { userId },
    data: { memoryCount: { increment: 1 } }
  });
}
```

### 3.3 ê³µì • ì‚¬ìš© ì •ì±… (Fair Use Policy)

#### 3.3.1 ìœ ë£Œ ì‚¬ìš©ì ì œí•œ
**ëª©ì **: ì•…ìš© ë°©ì§€ (API ë‚¨ìš©, ë´‡ íŠ¸ë˜í”½ ë“±)

**ì œí•œ ì‚¬í•­**:
- ë…¸í¬: 1ì¼ ìµœëŒ€ 50íšŒ (ì†Œí”„íŠ¸ ë¦¬ë°‹, ì´ˆê³¼ ì‹œ ê²½ê³ )
- ëŒ€í™”: 1ì¼ ìµœëŒ€ 500ê°œ ë©”ì‹œì§€
- LLM API í˜¸ì¶œ: 1ë¶„ë‹¹ 60íšŒ

**ì´ˆê³¼ ì‹œ ì²˜ë¦¬**:
```typescript
async function checkFairUsePolicy(userId: string): Promise<{
  allowed: boolean;
  reason?: string;
}> {
  const usage = await getRecentUsage(userId, 24); // ìµœê·¼ 24ì‹œê°„

  if (usage.knocks > 50) {
    await sendWarningEmail(userId, 'excessive_knocks');
    return {
      allowed: false,
      reason: 'ê³µì • ì‚¬ìš© ì •ì±… ìœ„ë°˜: ë…¸í¬ íšŸìˆ˜ ì´ˆê³¼'
    };
  }

  if (usage.messages > 500) {
    return {
      allowed: false,
      reason: 'ê³µì • ì‚¬ìš© ì •ì±… ìœ„ë°˜: ë©”ì‹œì§€ ìˆ˜ ì´ˆê³¼'
    };
  }

  return { allowed: true };
}
```

---

## 4. ì—…ê·¸ë ˆì´ë“œ/ë‹¤ìš´ê·¸ë ˆì´ë“œ

### 4.1 ë¬´ë£Œ â†’ ìœ ë£Œ ì—…ê·¸ë ˆì´ë“œ

#### 4.1.1 ì—…ê·¸ë ˆì´ë“œ íŠ¸ë¦¬ê±°
**ì§€ì **:
1. ë…¸í¬ ì œí•œ ë„ë‹¬ ì‹œ ëª¨ë‹¬
2. ë©”ëª¨ë¦¬ ì œí•œ ë„ë‹¬ ì‹œ ë°°ë„ˆ
3. ì„¤ì • > êµ¬ë… ê´€ë¦¬ í˜ì´ì§€
4. ëŒ€í™” ì¤‘ "ë” ê¹Šì€ ëŒ€í™”" ì œì•ˆ

#### 4.1.2 ì¦‰ì‹œ íš¨ê³¼
- êµ¬ë… í™œì„±í™” ì¦‰ì‹œ ì œí•œ í•´ì œ
- ê¸°ì¡´ ë°ì´í„° ìœ ì§€
- ì¶”ê°€ ë©”ëª¨ë¦¬ ìŠ¬ë¡¯ í™œì„±í™”

### 4.2 ìœ ë£Œ â†’ ë¬´ë£Œ ë‹¤ìš´ê·¸ë ˆì´ë“œ

#### 4.2.1 ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œì 
- êµ¬ë… ì·¨ì†Œ í›„ í˜„ì¬ ê¸°ê°„ ì¢…ë£Œ ì‹œ
- ê²°ì œ ì‹¤íŒ¨ í›„ ìœ ì˜ˆ ê¸°ê°„ ì¢…ë£Œ ì‹œ

#### 4.2.2 ë°ì´í„° ì²˜ë¦¬
```typescript
async function handleDowngrade(userId: string) {
  // 1. êµ¬ë… ìƒíƒœ ë³€ê²½
  await prisma.subscription.update({
    where: { userId },
    data: {
      planType: 'free',
      status: 'active'
    }
  });

  // 2. ì‚¬ìš©ëŸ‰ ì œí•œ ë³µì›
  await prisma.usageQuota.update({
    where: { userId },
    data: {
      dailyKnocksLimit: 1,
      memoryLimit: 5,
      relationshipEditsLimit: 0
    }
  });

  // 3. ì´ˆê³¼ ë©”ëª¨ë¦¬ ì²˜ë¦¬
  const memoryCount = await prisma.memory.count({ where: { userId } });
  if (memoryCount > 5) {
    // ìµœì‹  5ê°œë§Œ ë‚¨ê¸°ê³  ì‚­ì œ
    const memories = await prisma.memory.findMany({
      where: { userId },
      orderBy: { createdAt: 'desc' },
      skip: 5
    });

    await prisma.memory.deleteMany({
      where: { id: { in: memories.map(m => m.id) } }
    });
  }

  // 4. ê´€ê³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ë¹„í™œì„±í™” (ë°ì´í„°ëŠ” ìœ ì§€)
  // (í”„ë¡¬í”„íŠ¸ëŠ” ê·¸ëŒ€ë¡œ, ìˆ˜ì • ê¸°ëŠ¥ë§Œ ë¹„í™œì„±í™”)

  // 5. ì•Œë¦¼
  await sendDowngradeNotification(userId);
}
```

---

## 5. ê°€ê²© ì „ëµ

### 5.1 ê²½ìŸ ë¶„ì„
| ì„œë¹„ìŠ¤ | ê°€ê²© | ì£¼ìš” í˜œíƒ |
|--------|------|-----------|
| ChatGPT Plus | $20/ì›” | GPT-4 ì ‘ê·¼, ìš°ì„  ì²˜ë¦¬ |
| Claude Pro | $20/ì›” | Claude 3 Opus, 5ë°° ì‚¬ìš©ëŸ‰ |
| Character.AI Plus | $9.99/ì›” | ìš°ì„  ì ‘ê·¼, ë¹ ë¥¸ ì‘ë‹µ |
| Replika Pro | $19.99/ì›” | ìŒì„± í†µí™”, ê´€ê³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• |
| **Knock Plus** | **$9.99/ì›”** | ë¬´ì œí•œ ë…¸í¬, Pro LLM, 50ê°œ ë©”ëª¨ë¦¬ |

### 5.2 ê°€ê²© í…ŒìŠ¤íŠ¸ ì „ëµ
**A/B í…ŒìŠ¤íŠ¸**:
- Group A: $9.99/ì›”
- Group B: $7.99/ì›” (ì €ê°€ ì „ëµ)
- Group C: $12.99/ì›” (ê³ ê°€ ì „ëµ)

**ì¸¡ì • ì§€í‘œ**:
- ì „í™˜ìœ¨ (Conversion Rate)
- MRR (Monthly Recurring Revenue)
- LTV (Lifetime Value)

### 5.3 í”„ë¡œëª¨ì…˜ ì „ëµ

#### 5.3.1 ë¬´ë£Œ ì²´í—˜
- ì‹ ê·œ ê°€ì… ì‹œ 7ì¼ ë¬´ë£Œ ì²´í—˜
- ì²´í—˜ ì¢…ë£Œ 3ì¼ ì „ ì•Œë¦¼

#### 5.3.2 í• ì¸ ì¿ í°
```typescript
CREATE TABLE promo_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(50) UNIQUE NOT NULL,
  discount_percent INT, -- 10, 20, 30...
  discount_amount_cents INT, -- ê³ ì • ê¸ˆì•¡ í• ì¸ (ì„¼íŠ¸)
  valid_from TIMESTAMP DEFAULT NOW(),
  valid_until TIMESTAMP,
  max_uses INT,
  current_uses INT DEFAULT 0,
  applicable_plans TEXT[], -- ['plus_monthly', 'plus_yearly']
  created_at TIMESTAMP DEFAULT NOW()
);

-- ì˜ˆì‹œ: ì‹ ê·œ ê°€ì… 30% í• ì¸
INSERT INTO promo_codes (code, discount_percent, valid_until, applicable_plans)
VALUES ('WELCOME30', 30, '2025-12-31', ARRAY['plus_monthly', 'plus_yearly']);
```

#### 5.3.3 ì—°ê°„ í”Œëœ í• ì¸
- 20% í• ì¸ ($9.99 x 12 = $119.88 â†’ $95.88)
- ì ˆê°ì•¡ ê°•ì¡°: "ì—°ê°„ í”Œëœìœ¼ë¡œ $24 ì ˆì•½!"

---

## 6. ì˜ˆì™¸ ì²˜ë¦¬

### 6.1 ê²°ì œ ì‹¤íŒ¨
- ìë™ ì¬ì‹œë„ (3ì¼, 5ì¼, 7ì¼)
- ì´ë©”ì¼/ì•± ì•Œë¦¼
- ìœ ì˜ˆ ê¸°ê°„ ì œê³µ (7ì¼)

### 6.2 í™˜ë¶ˆ ìš”ì²­
- ê²°ì œ í›„ 14ì¼ ì´ë‚´ ì „ì•¡ í™˜ë¶ˆ ê°€ëŠ¥
- í™˜ë¶ˆ ì²˜ë¦¬ í›„ ì¦‰ì‹œ ë¬´ë£Œ í”Œëœ ì „í™˜

### 6.3 ì´ì¤‘ êµ¬ë… ë°©ì§€
- ì‚¬ìš©ìë‹¹ 1ê°œ êµ¬ë…ë§Œ í—ˆìš©
- ê¸°ì¡´ êµ¬ë… ìˆìœ¼ë©´ ì—…ê·¸ë ˆì´ë“œ/ë‹¤ìš´ê·¸ë ˆì´ë“œ ë¡œì§ ì‹¤í–‰

---

## 7. ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­

### 7.1 ë³´ì•ˆ
- PCI-DSS ì¤€ìˆ˜ (Stripe ì‚¬ìš©ìœ¼ë¡œ ìë™ ì¶©ì¡±)
- ì›¹í›… ì„œëª… ê²€ì¦ (Stripe Signature)
- HTTPS í†µì‹  í•„ìˆ˜

### 7.2 ì„±ëŠ¥
- êµ¬ë… ìƒíƒœ ì¡°íšŒ: Redis ìºì‹± (1ë¶„ TTL)
- ì‚¬ìš©ëŸ‰ ì²´í¬: ë©”ëª¨ë¦¬ ìºì‹œ (10ì´ˆ TTL)

### 7.3 ê°€ìš©ì„±
- ê²°ì œ ì‹œìŠ¤í…œ ì¥ì•  ì‹œ ì¬ì‹œë„ í
- ì›¹í›… ì´ë²¤íŠ¸ ì†ì‹¤ ë°©ì§€ (DB ë¡œê·¸)

---

## 8. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 8.1 ì •ìƒ í”Œë¡œìš°
1. ë¬´ë£Œ ì‚¬ìš©ì â†’ ë…¸í¬ ì œí•œ ë„ë‹¬
2. ì—…ê·¸ë ˆì´ë“œ ëª¨ë‹¬ í‘œì‹œ
3. í”Œëœ ì„ íƒ â†’ Stripe Checkout
4. ê²°ì œ ì™„ë£Œ â†’ ì›¹í›… ìˆ˜ì‹ 
5. êµ¬ë… í™œì„±í™” â†’ ì œí•œ í•´ì œ í™•ì¸

### 8.2 ì˜ˆì™¸ í”Œë¡œìš°
1. ê²°ì œ ì‹¤íŒ¨ â†’ ì¬ì‹œë„ ë¡œì§
2. ì›¹í›… ì§€ì—° â†’ ìˆ˜ë™ ë™ê¸°í™”
3. êµ¬ë… ì·¨ì†Œ â†’ ë°ì´í„° ë‹¤ìš´ê·¸ë ˆì´ë“œ

---

## 9. ê°œë°œ ìš°ì„ ìˆœìœ„

**Phase 1 (MVP)**:
- ë¬´ë£Œ/ìœ ë£Œ í”Œëœ êµ¬ë¶„
- Stripe ê²°ì œ í†µí•©
- ë…¸í¬ ì‚¬ìš©ëŸ‰ ì¶”ì 
- ê¸°ë³¸ êµ¬ë… ê´€ë¦¬ (ìƒì„±, ì·¨ì†Œ)

**Phase 2 (Enhancement)**:
- ë©”ëª¨ë¦¬ ì œí•œ ì ìš©
- ê´€ê³„ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê¸°ëŠ¥
- í”„ë¡œëª¨ì…˜ ì½”ë“œ ì‹œìŠ¤í…œ
- ë¬´ë£Œ ì²´í—˜

**Phase 3 (Optimization)**:
- ì·¨ì†Œ ìœ ì§€ ì „ëµ
- ë™ì  ê°€ê²© ìµœì í™”
- ì‚¬ìš©ëŸ‰ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
