# 비즈니스 모델 - 사용자 플로우

## 플로우 다이어그램

```
[무료 사용자]
    ↓
[제한 도달 경험]
    ↓
    ├─ [노크 제한] → [업그레이드 모달]
    ├─ [메모리 제한] → [업그레이드 배너]
    └─ [LLM 제한] → [대화 중 제안]
    ↓
[플랜 비교 화면]
    ↓
[플랜 선택]
    ↓
[결제 수단 입력]
    ↓
[결제 처리]
    ↓
    ├─ [성공] → [구독 활성화]
    │              ↓
    │         [완료 화면]
    │              ↓
    │         [유료 기능 사용]
    │
    └─ [실패] → [오류 안내] → [재시도]
```

---

## 상세 단계별 플로우

### Step 1: 제한 도달 경험 (Paywall)

#### Case A: 노크 제한 도달
**트리거**: 무료 사용자가 오늘의 1회 노크를 이미 사용함

**화면 요소**:
```
┌────────────────────────────────────────┐
│   오늘의 무료 노크를 모두 사용했어요   │
├────────────────────────────────────────┤
│                                        │
│  🕐 다음 노크까지: 14시간 23분         │
│                                        │
│  Knock Plus로 업그레이드하면:          │
│  ✓ 지금 바로 노크 가능                 │
│  ✓ 무제한 노크                         │
│  ✓ 더 스마트한 LLM (Pro 모델)          │
│  ✓ 50개 메모리 (10배 증가)             │
│                                        │
│     [Knock Plus 시작하기]              │
│     [내일 다시 올게요]                 │
└────────────────────────────────────────┘
```

**사용자 액션**:
- [Knock Plus 시작하기] → Step 2
- [내일 다시 올게요] → 모달 닫기

**A/B 테스트 변형**:
- Variant A (현재): 명확한 혜택 나열
- Variant B: 감성적 카피 ("더 많은 이웃과 친구가 되세요")
- Variant C: 할인 강조 ("첫 달 30% 할인")

**소요 시간**: 3-5초 (읽기)

---

#### Case B: 메모리 제한 도달
**트리거**: 무료 사용자가 6번째 대화 메모리 생성 시도

**화면 요소**:
- 화면 상단 배너 (침습적이지 않게)
```
┌────────────────────────────────────────┐
│ 💡 메모리가 가득 찼어요 (5/5)          │
│ Plus로 업그레이드하면 50개까지 저장!   │
│                          [자세히 보기] │
└────────────────────────────────────────┘
```

**동작**:
- 가장 오래된 메모리 자동 삭제 (FIFO)
- 사용자에게 안내: "가장 오래된 대화 메모리가 삭제되었어요"

**사용자 액션**:
- [자세히 보기] → Step 2
- 배너 무시 → 계속 사용

**전환 압박도**: 낮음 (배경 알림 수준)

---

#### Case C: 대화 중 LLM 제한 경험
**트리거**: 복잡한 질문 시 기본 LLM의 제한적인 응답

**화면 요소**:
- 대화 하단 제안 카드
```
┌────────────────────────────────────────┐
│  💬 더 깊은 대화를 원하시나요?         │
│                                        │
│  Knock Plus의 Pro LLM은:               │
│  • 더 길고 풍부한 답변                 │
│  • 복잡한 맥락 이해                    │
│  • 장문 대화 지원                      │
│                                        │
│        [Pro로 업그레이드]              │
└────────────────────────────────────────┘
```

**트리거 조건**:
- 사용자 메시지 길이 > 100자
- 이전 대화 5회 이상
- 무료 플랜 사용 중

**전환 압박도**: 중간 (자연스러운 제안)

---

### Step 2: 플랜 비교 화면
**목표**: 무료 vs 유료 명확한 가치 비교

**화면 구성**:
```
┌────────────────────────────────────────────────────────────┐
│                  Knock Plus로 업그레이드                   │
├──────────────────────┬─────────────────────────────────────┤
│   무료 플랜 (현재)   │         Knock Plus                  │
├──────────────────────┼─────────────────────────────────────┤
│ ✓ 1일 1회 노크       │ ✓ 무제한 노크 (즉시 실행)            │
│ ✓ 기본 LLM (Flash)   │ ✓ 고급 LLM (Pro, 2배 스마트)         │
│ ✓ 5개 메모리         │ ✓ 50개 메모리 (10배 증가)            │
│ ✗ 관계 커스터마이징  │ ✓ 관계 관리 (키워드 추가/삭제)       │
│ ✗ AI 생성 방 이미지  │ ✓ AI 생성 방 이미지                  │
│                      │                                     │
│   무료               │   $9.99/월                          │
│   [현재 플랜]        │   [구독 시작하기]                   │
└──────────────────────┴─────────────────────────────────────┘

               [연간 플랜으로 $24 절약하기]
```

**추가 요소**:
- "7일 무료 체험" 배지 (프로모션 기간)
- 고객 후기 (선택): "Plus로 바꾼 후 대화가 훨씬 풍부해졌어요!"
- FAQ 링크: "자주 묻는 질문"

**사용자 액션**:
- [구독 시작하기] (월간) → Step 3
- [연간 플랜으로 $24 절약하기] → Step 3 (연간 플랜 선택)
- [현재 플랜] → 모달 닫기

**소요 시간**: 15-30초

---

### Step 3: 플랜 선택 (월간 vs 연간)
**화면 구성**:
```
┌────────────────────────────────────────┐
│         플랜을 선택해주세요            │
├────────────────────────────────────────┤
│                                        │
│  ○ 월간 플랜                           │
│     $9.99/월                           │
│     언제든지 취소 가능                 │
│                                        │
│  ● 연간 플랜 (20% 할인) 🎉             │
│     $95.88/년 ($7.99/월)               │
│     $24 절약!                          │
│                                        │
│           [계속하기]                   │
└────────────────────────────────────────┘
```

**기본 선택**: 연간 플랜 (권장)

**사용자 액션**:
- 플랜 선택 (라디오 버튼)
- [계속하기] → Step 4

**소요 시간**: 5-10초

---

### Step 4: 결제 수단 입력 (Stripe Checkout)
**목표**: 안전하고 빠른 결제 처리

**API 호출**:
```javascript
POST /api/v1/subscriptions/create
{
  "planType": "plus_yearly",
  "paymentMethod": "stripe",
  "successUrl": "https://knock.com/subscription/success",
  "cancelUrl": "https://knock.com/subscription/cancel"
}

// Response:
{
  "checkoutUrl": "https://checkout.stripe.com/c/pay/cs_test_..."
}

// 리다이렉트
window.location.href = checkoutUrl;
```

**Stripe Checkout 화면**:
- Stripe의 호스팅 결제 페이지
- 카드 정보 입력
- 청구 주소 입력
- 이메일 확인

**결제 수단**:
- 신용카드/체크카드 (Visa, Mastercard, Amex)
- Google Pay / Apple Pay (선택)

**보안**:
- PCI-DSS 준수 (Stripe 자동 처리)
- 3D Secure 인증 (카드사 요구 시)

**소요 시간**: 30-60초

---

### Step 5: 결제 처리
**백엔드 프로세스**:
1. Stripe 결제 요청 (클라이언트 → Stripe)
2. 카드사 승인 확인 (Stripe → 카드사)
3. 결제 완료 이벤트 (Stripe → 웹훅 서버)

**웹훅 처리**:
```typescript
POST /api/v1/webhooks/stripe
{
  "type": "checkout.session.completed",
  "data": {
    "object": {
      "customer": "cus_...",
      "subscription": "sub_...",
      "metadata": { "userId": "550e8400-..." }
    }
  }
}

// 백엔드 처리:
1. 구독 레코드 생성
2. 사용량 제한 업데이트
3. 사용자에게 알림
```

**로딩 화면**:
```
┌────────────────────────────────────────┐
│                                        │
│          [로딩 애니메이션]              │
│                                        │
│     결제를 처리하고 있어요...          │
│     잠시만 기다려주세요                │
│                                        │
└────────────────────────────────────────┘
```

**소요 시간**: 3-5초

---

### Step 6: 결제 성공 - 완료 화면
**목표**: 환영 및 다음 액션 유도

**화면 구성**:
```
┌────────────────────────────────────────┐
│            🎉 환영합니다!              │
│                                        │
│    Knock Plus 구독이 시작되었어요     │
├────────────────────────────────────────┤
│                                        │
│  이제 이런 기능을 사용할 수 있어요:    │
│                                        │
│  ✓ 무제한 노크로 더 많은 이웃 발견     │
│  ✓ 고급 LLM으로 깊은 대화              │
│  ✓ 50개 메모리로 연속성 있는 관계      │
│  ✓ 관계 커스터마이징                   │
│                                        │
│  구독 정보:                            │
│  플랜: Knock Plus Yearly               │
│  결제 금액: $95.88/년                  │
│  다음 결제일: 2026-10-27               │
│                                        │
│        [지금 바로 노크하기]            │
│        [구독 관리 페이지]              │
└────────────────────────────────────────┘
```

**자동 액션**:
1. 환영 이메일 발송
2. 구독 영수증 발송
3. 분석 이벤트 기록 (`subscription_activated`)

**사용자 액션**:
- [지금 바로 노크하기] → 메인 화면 (노크 기능 활성화)
- [구독 관리 페이지] → 설정 > 구독 관리

**소요 시간**: 5-10초

---

### Step 7: 유료 기능 사용
**즉시 활성화되는 기능**:
1. 노크 버튼 활성화 (쿨다운 없음)
2. 대화 시 Pro LLM 사용
3. 메모리 슬롯 50개로 확장
4. 설정에서 "관계 관리" 메뉴 활성화

**첫 유료 노크 경험**:
```
┌────────────────────────────────────────┐
│   🚀 Plus 전용: 즉시 노크!             │
│                                        │
│   쿨다운 없이 바로 새 이웃을 만나요    │
│                                        │
│           [노크하기]                   │
└────────────────────────────────────────┘
```

**애니메이션**:
- "Plus" 배지 반짝임 효과
- 노크 버튼 특별 스타일 (골드 테두리)

---

## 구독 관리 플로우

### Flow A: 구독 정보 확인
**위치**: 설정 > 구독 관리

**화면 구성**:
```
┌────────────────────────────────────────┐
│           내 구독 정보                 │
├────────────────────────────────────────┤
│                                        │
│  현재 플랜: Knock Plus Yearly          │
│  상태: 활성                            │
│                                        │
│  결제 정보:                            │
│  - 카드: •••• 1234 (Visa)             │
│  - 다음 결제일: 2026-10-27             │
│  - 금액: $95.88                        │
│                                        │
│  [결제 수단 변경]                      │
│  [영수증 보기]                         │
│  [구독 취소]                           │
└────────────────────────────────────────┘
```

---

### Flow B: 구독 취소
**트리거**: [구독 취소] 버튼 클릭

**Step 1: 취소 확인 모달**
```
┌────────────────────────────────────────┐
│       정말 떠나시나요? 😢              │
├────────────────────────────────────────┤
│                                        │
│  Knock Plus를 취소하시면:              │
│  ✗ 무제한 노크 불가                    │
│  ✗ 고급 LLM 사용 불가                  │
│  ✗ 메모리 5개로 감소 (45개 삭제)       │
│  ✗ 관계 관리 기능 잠김                 │
│                                        │
│  아직 [14일] 남았어요!                 │
│  기간 종료까지 모든 혜택을 누리세요    │
│                                        │
│  🎁 특별 제안: 다음 3개월 30% 할인     │
│     ($6.99/월로 계속하기)              │
│                                        │
│  [할인 받고 계속하기]  [취소 진행]     │
└────────────────────────────────────────┘
```

**사용자 액션**:
- [할인 받고 계속하기] → 프로모션 코드 적용 후 유지
- [취소 진행] → Step 2

**전환율 목표**: 30% (취소 방지)

---

**Step 2: 취소 옵션 선택**
```
┌────────────────────────────────────────┐
│        취소 방법을 선택해주세요        │
├────────────────────────────────────────┤
│                                        │
│  ○ 기간 종료 시 취소 (권장)            │
│     2026-10-27까지 Plus 혜택 유지      │
│     자동으로 무료 플랜 전환            │
│                                        │
│  ○ 즉시 취소                           │
│     지금 바로 무료 플랜으로 전환       │
│     환불 불가 (이용 약관 참조)         │
│                                        │
│           [취소하기]                   │
│           [돌아가기]                   │
└────────────────────────────────────────┘
```

**사용자 액션**:
- 옵션 선택 후 [취소하기] → Step 3
- [돌아가기] → 구독 유지

---

**Step 3: 취소 이유 피드백 (선택)**
```
┌────────────────────────────────────────┐
│   떠나시는 이유를 알려주세요 (선택)    │
├────────────────────────────────────────┤
│                                        │
│  ○ 너무 비싸요                         │
│  ○ 자주 사용하지 않아요                │
│  ○ 원하는 기능이 없어요                │
│  ○ 기술적 문제가 있어요                │
│  ○ 기타:                               │
│     [텍스트 입력 필드]                 │
│                                        │
│           [제출하고 취소]              │
│           [건너뛰기]                   │
└────────────────────────────────────────┘
```

**API 호출**:
```javascript
POST /api/v1/subscriptions/cancel
{
  "immediately": false,
  "reason": "too_expensive",
  "feedback": "학생이라 부담스러워요"
}
```

---

**Step 4: 취소 완료**
```
┌────────────────────────────────────────┐
│          구독이 취소되었어요           │
├────────────────────────────────────────┤
│                                        │
│  2026-10-27까지 Plus 혜택을 계속       │
│  사용할 수 있어요                      │
│                                        │
│  그 이후:                              │
│  - 무료 플랜으로 자동 전환             │
│  - 1일 1회 노크                        │
│  - 기본 LLM                            │
│  - 5개 메모리                          │
│                                        │
│  언제든지 다시 돌아오세요 💙           │
│                                        │
│        [메인으로 돌아가기]             │
└────────────────────────────────────────┘
```

---

## 결제 실패 플로우

### Flow C: 자동 결제 실패
**트리거**: Stripe 웹훅 `invoice.payment_failed`

**Step 1: 즉시 알림**
- 앱 내 알림
- 이메일 발송: "결제에 문제가 발생했어요"

**화면 배너**:
```
┌────────────────────────────────────────┐
│ ⚠️ 결제 실패: 카드 정보를 확인해주세요  │
│                       [결제 수단 업데이트]│
└────────────────────────────────────────┘
```

**Step 2: 재시도 스케줄**
- 3일 후 자동 재시도
- 5일 후 자동 재시도
- 7일 후 최종 재시도

**Step 3: 유예 기간 종료**
- 7일 후에도 실패 시 구독 만료
- 무료 플랜으로 다운그레이드 (데이터 처리)

---

## 전체 타임라인

| Step | 화면 | 평균 소요 시간 | 누적 시간 |
|------|------|----------------|-----------|
| 1 | 제한 도달 경험 | 5초 | 5초 |
| 2 | 플랜 비교 | 30초 | 35초 |
| 3 | 플랜 선택 | 10초 | 45초 |
| 4 | 결제 수단 입력 | 60초 | 105초 |
| 5 | 결제 처리 | 5초 | 110초 |
| 6 | 완료 화면 | 10초 | 120초 |

**목표**: 3분 이내 전환 완료

---

## 전환 최적화 전략

### 포인트 1: 제한 경험 설계
- **타이밍**: 사용자가 가치를 충분히 느낀 후 (3-5회 노크 후)
- **톤앤매너**: 강압적이지 않고 혜택 중심
- **빈도**: 1일 최대 2회 업그레이드 제안

### 포인트 2: 가격 앵커링
- 연간 플랜 할인 강조 ($119.88 → $95.88, 선을 그어 표시)
- 경쟁사 가격 비교 (선택): "ChatGPT Plus의 절반 가격"

### 포인트 3: 사회적 증거
- "1,234명의 사용자가 Plus를 선택했어요"
- 고객 후기 표시 (선택)

### 포인트 4: 긴급성
- "7일 무료 체험은 오늘까지!" (프로모션 기간)
- "첫 100명 30% 할인" (한정 수량)

---

## A/B 테스트 아이디어

### Test 1: 제한 경험 카피
- **A**: "오늘의 노크를 모두 사용했어요" (중립적)
- **B**: "아쉽지만 노크 제한에 도달했어요" (감성적)

### Test 2: 가격 표시 방식
- **A**: "$9.99/월" (단순)
- **B**: "하루 $0.33, 커피 한 잔보다 저렴" (비교)

### Test 3: 무료 체험 제공 여부
- **A**: 무료 체험 7일 (전환율 ↑, 이탈률 ↑ 가능)
- **B**: 무료 체험 없음 (전환율 ↓, 유지율 ↑)

**측정 지표**:
- 전환율 (Conversion Rate)
- 이탈률 (Churn Rate)
- LTV (Lifetime Value)
